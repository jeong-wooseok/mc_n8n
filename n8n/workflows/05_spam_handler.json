{
  "name": "ğŸ—‘ï¸ ìŠ¤íŒ¸ ì´ë©”ì¼ ì²˜ë¦¬ ì›Œí¬í”Œë¡œìš°",
  "nodes": [
    {
      "parameters": {},
      "id": "workflow-trigger",
      "name": "ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±°",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "jsCode": "// ìŠ¤íŒ¸ ì´ë©”ì¼ ë¶„ì„ ë° ìœ„í—˜ë„ í‰ê°€\nconst data = $input.item(0).json;\n\n// í”¼ì‹± ì˜ì‹¬ í‚¤ì›Œë“œ\nconst phishingKeywords = [\n  'ê¸´ê¸‰', 'ì¦‰ì‹œ', 'ê³„ì • ì •ì§€', 'ê³„ì • í™•ì¸', 'í´ë¦­í•˜ì„¸ìš”', 'verify account',\n  'ë¹„ë°€ë²ˆí˜¸ ë³€ê²½', 'ë¡œê·¸ì¸ ë§í¬', 'ë‹¹ì²¨', 'ë¬´ë£Œ', 'ìƒê¸ˆ', 'ì´ë²¤íŠ¸ ë‹¹ì²¨',\n  'ê°œì¸ì •ë³´', 'ì¹´ë“œë²ˆí˜¸', 'ê³„ì¢Œë²ˆí˜¸', 'ë³´ì•ˆì½”ë“œ', 'credit card'\n];\n\n// ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ë„ë©”ì¸ íŒ¨í„´\nconst suspiciousDomains = [\n  'temp-mail', 'guerrillamail', '10minutemail', 'mailinator',\n  'gmai1.com', 'gmial.com', 'outlok.com' // íƒ€ì´í¬ìŠ¤ì¿¼íŒ…\n];\n\n// ìŠ¤íŒ¸ ì ìˆ˜ ê³„ì‚°\nfunction calculateSpamScore(emailData) {\n  let score = 0;\n  const emailText = `${emailData.subject} ${emailData.body}`.toLowerCase();\n  \n  // í”¼ì‹± í‚¤ì›Œë“œ ì²´í¬\n  const matchedPhishingWords = phishingKeywords.filter(keyword => \n    emailText.includes(keyword.toLowerCase())\n  );\n  score += matchedPhishingWords.length * 10;\n  \n  // ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ë„ë©”ì¸ ì²´í¬\n  const senderDomain = emailData.from.split('@')[1]?.toLowerCase() || '';\n  const isDomainSuspicious = suspiciousDomains.some(domain => \n    senderDomain.includes(domain)\n  );\n  if (isDomainSuspicious) score += 20;\n  \n  // ì œëª©ì— ê³¼ë„í•œ íŠ¹ìˆ˜ë¬¸ì ì‚¬ìš©\n  const specialCharCount = (emailData.subject.match(/[!@#$%^&*()]/g) || []).length;\n  if (specialCharCount > 3) score += 15;\n  \n  // ë³¸ë¬¸ì— URLì´ ë§ì€ ê²½ìš°\n  const urlCount = (emailData.body.match(/https?:\\/\\//g) || []).length;\n  if (urlCount > 5) score += 10;\n  \n  return {\n    total_score: score,\n    phishing_keywords: matchedPhishingWords,\n    suspicious_domain: isDomainSuspicious,\n    special_chars: specialCharCount,\n    url_count: urlCount\n  };\n}\n\nconst spamAnalysis = calculateSpamScore(data);\nconst riskLevel = spamAnalysis.total_score >= 30 ? 'high' : \n                 spamAnalysis.total_score >= 15 ? 'medium' : 'low';\n\nconst spamData = {\n  email_info: {\n    from: data.from,\n    subject: data.subject,\n    summary: data.summary,\n    timestamp: data.timestamp,\n    messageId: data.messageId\n  },\n  spam_analysis: {\n    ...spamAnalysis,\n    risk_level: riskLevel,\n    is_phishing_suspected: spamAnalysis.total_score >= 30\n  },\n  security_alert: {\n    alert_type: 'spam_detection',\n    severity: riskLevel,\n    details: {\n      sender: data.from,\n      subject: data.subject,\n      phishing_indicators: spamAnalysis.phishing_keywords,\n      risk_score: spamAnalysis.total_score\n    }\n  }\n};\n\nreturn [{ json: spamData }];"
      },
      "id": "spam-analyzer",
      "name": "ìŠ¤íŒ¸ ë¶„ì„",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 300]
    },
    {
      "parameters": {
        "operation": "delete",
        "messageId": "={{ $json.email_info.messageId }}"
      },
      "id": "gmail-delete",
      "name": "Gmail ì´ë©”ì¼ ì‚­ì œ",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2,
      "position": [680, 200],
      "credentials": {
        "gmailOAuth2": {
          "id": "gmail_credentials",
          "name": "Gmail OAuth2"
        }
      }
    },
    {
      "parameters": {
        "operation": "createFilter",
        "criteria": {
          "from": "={{ $json.email_info.from }}"
        },
        "action": {
          "addLabelIds": ["SPAM"],
          "removeLabelIds": ["INBOX"]
        }
      },
      "id": "gmail-filter",
      "name": "Gmail í•„í„° ìƒì„±",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2,
      "position": [680, 300],
      "credentials": {
        "gmailOAuth2": {
          "id": "gmail_credentials",
          "name": "Gmail OAuth2"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "phishing-suspected",
              "leftValue": "={{ $json.spam_analysis.is_phishing_suspected }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "true"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "phishing-check",
      "name": "í”¼ì‹± ì˜ì‹¬ ì²´í¬",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [900, 300]
    },
    {
      "parameters": {
        "url": "{{ $vars.SECURITY_TEAM_WEBHOOK }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.security_alert }}",
        "options": {}
      },
      "id": "security-alert",
      "name": "ë³´ì•ˆíŒ€ ì•Œë¦¼",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1120, 200]
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C5678901234",
          "mode": "list",
          "cachedResultName": "#security-alerts"
        },
        "text": "ğŸš¨ *í”¼ì‹± ì˜ì‹¬ ì´ë©”ì¼ íƒì§€* ğŸš¨",
        "blocksUi": {
          "blocksValues": [
            {
              "block": "={{ JSON.stringify([\n                {\n                  \"type\": \"header\",\n                  \"text\": {\n                    \"type\": \"plain_text\",\n                    \"text\": \"ğŸš¨ í”¼ì‹± ì˜ì‹¬ ì´ë©”ì¼ íƒì§€\"\n                  }\n                },\n                {\n                  \"type\": \"section\",\n                  \"fields\": [\n                    {\n                      \"type\": \"mrkdwn\",\n                      \"text\": `*ë°œì‹ ì:*\\n${$json.email_info.from}`\n                    },\n                    {\n                      \"type\": \"mrkdwn\",\n                      \"text\": `*ìœ„í—˜ë„:*\\n${$json.spam_analysis.risk_level.toUpperCase()}`\n                    }\n                  ]\n                },\n                {\n                  \"type\": \"section\",\n                  \"text\": {\n                    \"type\": \"mrkdwn\",\n                    \"text\": `*ì œëª©:* ${$json.email_info.subject}\\n*ìŠ¤íŒ¸ ì ìˆ˜:* ${$json.spam_analysis.total_score}/100\\n*í”¼ì‹± í‚¤ì›Œë“œ:* ${$json.spam_analysis.phishing_keywords.join(', ')}`\n                  }\n                },\n                {\n                  \"type\": \"actions\",\n                  \"elements\": [\n                    {\n                      \"type\": \"button\",\n                      \"text\": {\n                        \"type\": \"plain_text\",\n                        \"text\": \"ìƒì„¸ ì¡°ì‚¬\"\n                      },\n                      \"style\": \"danger\",\n                      \"value\": $json.email_info.messageId\n                    }\n                  ]\n                }\n              ]) }}"
            }
          ]
        },
        "otherOptions": {
          "mrkdwn": true
        }
      },
      "id": "slack-phishing-alert",
      "name": "Slack í”¼ì‹± ì•Œë¦¼",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [1120, 300],
      "credentials": {
        "slackOAuth2Api": {
          "id": "slack_credentials",
          "name": "Slack OAuth2"
        }
      }
    },
    {
      "parameters": {
        "operation": "insert",
        "table": "spam_log",
        "columns": {
          "mappingMode": "defineBelow",
          "values": {
            "timestamp": "={{ $json.email_info.timestamp }}",
            "sender": "={{ $json.email_info.from }}",
            "subject": "={{ $json.email_info.subject }}",
            "spam_score": "={{ $json.spam_analysis.total_score }}",
            "risk_level": "={{ $json.spam_analysis.risk_level }}",
            "phishing_keywords": "={{ $json.spam_analysis.phishing_keywords.join(', ') }}",
            "action_taken": "deleted_and_blocked"
          }
        }
      },
      "id": "database-log",
      "name": "ë°ì´í„°ë² ì´ìŠ¤ ë¡œê¹…",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.4,
      "position": [680, 400],
      "credentials": {
        "postgres": {
          "id": "postgres_credentials",
          "name": "PostgreSQL"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ìŠ¤íŒ¸ íŒ¨í„´ í•™ìŠµ ë°ì´í„° ìƒì„±\nconst data = $input.item(0).json;\n\n// ê¸°ê³„í•™ìŠµì„ ìœ„í•œ íŠ¹ì„± ì¶”ì¶œ\nconst features = {\n  sender_domain: data.email_info.from.split('@')[1]?.toLowerCase(),\n  subject_length: data.email_info.subject.length,\n  special_char_ratio: data.spam_analysis.special_chars / data.email_info.subject.length,\n  url_count: data.spam_analysis.url_count,\n  phishing_keyword_count: data.spam_analysis.phishing_keywords.length,\n  has_suspicious_domain: data.spam_analysis.suspicious_domain,\n  spam_score: data.spam_analysis.total_score,\n  risk_level: data.spam_analysis.risk_level,\n  is_spam: true // ìŠ¤íŒ¸ìœ¼ë¡œ ë¶„ë¥˜ëœ ê²ƒì´ë¯€ë¡œ true\n};\n\n// í•™ìŠµ ë°ì´í„° í˜•ì‹ìœ¼ë¡œ ë³€í™˜\nconst trainingData = {\n  input_features: features,\n  label: 'spam',\n  confidence: data.spam_analysis.total_score / 100,\n  timestamp: data.email_info.timestamp\n};\n\nreturn [{ json: trainingData }];"
      },
      "id": "learning-data",
      "name": "í•™ìŠµ ë°ì´í„° ìƒì„±",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 500]
    },
    {
      "parameters": {
        "url": "{{ $vars.ML_TRAINING_API_URL }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json }}",
        "options": {}
      },
      "id": "ml-api",
      "name": "ML ëª¨ë¸ ì—…ë°ì´íŠ¸",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1120, 500]
    }
  ],
  "connections": {
    "ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±°": {
      "main": [
        [
          {
            "node": "ìŠ¤íŒ¸ ë¶„ì„",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ìŠ¤íŒ¸ ë¶„ì„": {
      "main": [
        [
          {
            "node": "Gmail ì´ë©”ì¼ ì‚­ì œ",
            "type": "main",
            "index": 0
          },
          {
            "node": "Gmail í•„í„° ìƒì„±",
            "type": "main",
            "index": 0
          },
          {
            "node": "ë°ì´í„°ë² ì´ìŠ¤ ë¡œê¹…",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gmail í•„í„° ìƒì„±": {
      "main": [
        [
          {
            "node": "í”¼ì‹± ì˜ì‹¬ ì²´í¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "í”¼ì‹± ì˜ì‹¬ ì²´í¬": {
      "main": [
        [
          {
            "node": "ë³´ì•ˆíŒ€ ì•Œë¦¼",
            "type": "main",
            "index": 0
          },
          {
            "node": "Slack í”¼ì‹± ì•Œë¦¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë°ì´í„°ë² ì´ìŠ¤ ë¡œê¹…": {
      "main": [
        [
          {
            "node": "í•™ìŠµ ë°ì´í„° ìƒì„±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "í•™ìŠµ ë°ì´í„° ìƒì„±": {
      "main": [
        [
          {
            "node": "ML ëª¨ë¸ ì—…ë°ì´íŠ¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2024-12-19T10:00:00.000Z",
      "updatedAt": "2024-12-19T10:00:00.000Z",
      "id": "email-automation",
      "name": "ì´ë©”ì¼ ìë™í™”"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2024-12-19T10:00:00.000Z",
  "versionId": "1"
} 