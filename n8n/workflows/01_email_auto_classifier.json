{
  "name": "ğŸ“§ ì´ë©”ì¼ ìë™ë¶„ë¥˜ë´‡ - ë©”ì¸ ì›Œí¬í”Œë¡œìš°",
  "nodes": [
    {
      "parameters": {
        "mode": "receivedEmail",
        "options": {
          "includeAttachments": false
        }
      },
      "id": "gmail-trigger",
      "name": "Gmail Trigger",
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1,
      "position": [240, 300],
      "credentials": {
        "gmailOAuth2": {
          "id": "gmail_credentials",
          "name": "Gmail OAuth2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ì´ë©”ì¼ ë°ì´í„° ì „ì²˜ë¦¬\nconst emailData = {\n  from: $input.item(0).json.from,\n  subject: $input.item(0).json.subject || '',\n  body: $input.item(0).json.textPlain || $input.item(0).json.textHtml || ''\n};\n\n// ë³¸ë¬¸ í…ìŠ¤íŠ¸ ì •ë¦¬ (HTML íƒœê·¸ ì œê±°, ê¸¸ì´ ì œí•œ)\nif (emailData.body) {\n  emailData.body = emailData.body\n    .replace(/<[^>]*>/g, '') // HTML íƒœê·¸ ì œê±°\n    .replace(/\\s+/g, ' ')    // ì—¬ëŸ¬ ê³µë°±ì„ í•˜ë‚˜ë¡œ\n    .substring(0, 1000);     // 1000ìë¡œ ì œí•œ\n}\n\nreturn [{ json: emailData }];"
      },
      "id": "data-preprocessing",
      "name": "ë°ì´í„° ì „ì²˜ë¦¬",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 300]
    },
    {
      "parameters": {
        "options": {},
        "systemPromptTemplate": "### ì—­í•  (Persona) ###\në‹¹ì‹ ì€ n8n ì›Œí¬í”Œë¡œìš° ë‚´ì—ì„œ ì‘ë™í•˜ëŠ” 'AI ì´ë©”ì¼ ë¶„ë¥˜ ì—ì´ì „íŠ¸'ì…ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ì„ë¬´ëŠ” ì´ì „ ë…¸ë“œ(Gmail Trigger)ë¡œë¶€í„° ë°›ì€ ì´ë©”ì¼ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³ , í›„ì† ìë™í™” ë‹¨ê³„ë¥¼ ìœ„í•´ êµ¬ì¡°í™”ëœ JSON ë°ì´í„°ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ì‘ë‹µì€ ë‹¤ë¥¸ ë…¸ë“œì˜ ì…ë ¥ê°’ìœ¼ë¡œ ì§ì ‘ ì‚¬ìš©ë˜ë¯€ë¡œ, ë°˜ë“œì‹œ ì§€ì •ëœ ì¶œë ¥ í˜•ì‹ì„ ì •í™•íˆ ì¤€ìˆ˜í•´ì•¼ í•©ë‹ˆë‹¤.\n\n### ì§€ì‹œì‚¬í•­ (Instruction) ###\nn8n ì›Œí¬í”Œë¡œìš°ì˜ ì¼ë¶€ë¡œì„œ, ë‹¹ì‹ ì€ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ìˆœì„œëŒ€ë¡œ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤:\n1. ì…ë ¥ìœ¼ë¡œ ì œê³µëœ ì´ë©”ì¼ ë°ì´í„°(from, subject, body)ë¥¼ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤.\n2. ì´ë©”ì¼ì˜ ë‚´ìš©ì„ íŒŒì•…í•˜ì—¬ ì•„ë˜ì— ì •ì˜ëœ 'ë¶„ë¥˜ ì¹´í…Œê³ ë¦¬' ì¤‘ ê°€ì¥ ì í•©í•œ í•˜ë‚˜ë¡œ ë¶„ë¥˜í•©ë‹ˆë‹¤.\n3. ì´ë©”ì¼ì˜ í•µì‹¬ ë‚´ìš©ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ ìš”ì•½í•©ë‹ˆë‹¤.\n4. ì´ë©”ì¼ì˜ ê¸´ê¸‰ë„ë¥¼ 1(ì •ë³´ì„±, ë‚®ìŒ)ë¶€í„° 5(ì¦‰ì‹œ ì²˜ë¦¬ í•„ìš”, ë§¤ìš° ë†’ìŒ)ê¹Œì§€ì˜ ì •ìˆ˜ë¡œ í‰ê°€í•©ë‹ˆë‹¤.\n5. ì‚¬ìš©ìì˜ êµ¬ì²´ì ì¸ ì‘ë‹µì´ë‚˜ í–‰ë™ì´ í•„ìš”í•œì§€ ì—¬ë¶€ë¥¼ 'true' ë˜ëŠ” 'false'ë¡œ íŒë‹¨í•©ë‹ˆë‹¤.\n6. ìœ„ ë¶„ì„ ê²°ê³¼ë¥¼ **ì˜¤ì§ í•˜ë‚˜ì˜ JSON ê°ì²´ í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µ**í•˜ì‹­ì‹œì˜¤. ë‹¤ë¥¸ ì„¤ëª…, ì¸ì‚¬, ì¶”ê°€ í…ìŠ¤íŠ¸ëŠ” ì ˆëŒ€ í¬í•¨í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.\n\n### ë¶„ë¥˜ ì¹´í…Œê³ ë¦¬ (Classification Categories) ###\n- **urgent:** ì¦‰ê°ì ì¸ í™•ì¸ê³¼ ì¡°ì¹˜ê°€ í•„ìš”í•œ ì´ë©”ì¼ (ì˜ˆ: ì„œë²„ ì¥ì•  ì•Œë¦¼, ê¸´ê¸‰ íšŒì˜ ìš”ì²­, ê³ ê°ì˜ ê¸´ê¸‰ í´ë ˆì„).\n- **important:** ë¹ ë¥¸ ì‹œì¼ ë‚´ì— í™•ì¸í•˜ê³  ì‘ë‹µí•´ì•¼ í•˜ëŠ” ì—…ë¬´ ê´€ë ¨ ì´ë©”ì¼ (ì˜ˆ: ì£¼ê°„ ë³´ê³  ìš”ì²­, ì¼ë°˜ ì—…ë¬´ í˜‘ì˜, ë¯¸íŒ… íŒ”ë¡œì—…).\n- **promotional:** ë‰´ìŠ¤ë ˆí„°, ê´‘ê³ , ë§ˆì¼€íŒ…, ì´ë²¤íŠ¸ ì •ë³´ ë“± ì •ë³´ì„± ë˜ëŠ” ê´‘ê³ ì„± ë©”ì¼.\n- **personal:** ì¹œêµ¬, ê°€ì¡±, ì§€ì¸ê³¼ì˜ ì‚¬ì ì¸ ëŒ€í™”.\n- **notification:** ì„œë¹„ìŠ¤ ê°€ì…, ê²°ì œ, ë°°ì†¡ ë“± ì‹œìŠ¤í…œì—ì„œ ìë™ìœ¼ë¡œ ë°œì†¡í•˜ëŠ” ì •ë³´ì„± ì•Œë¦¼.\n- **spam:** ë¶ˆí•„ìš”í•œ ê´‘ê³ , í”¼ì‹± ì‹œë„ ë“± ì‚¬ìš©ìê°€ ì›ì¹˜ ì•ŠëŠ” ì´ë©”ì¼.\n\n### ì¶œë ¥ í˜•ì‹ (Output Format) ###\në°˜ë“œì‹œ ë‹¤ìŒì˜ JSON êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‘ë‹µí•˜ì‹­ì‹œì˜¤:\n{\n  \"category\": \"ë¶„ë¥˜ ì¹´í…Œê³ ë¦¬ (ìœ„ 6ê°€ì§€ ì˜ë¬¸ ì†Œë¬¸ì í‚¤ ì¤‘ í•˜ë‚˜)\",\n  \"summary\": \"ì´ë©”ì¼ í•µì‹¬ ë‚´ìš© í•œ ë¬¸ì¥ ìš”ì•½\",\n  \"urgency_score\": \"ê¸´ê¸‰ë„ ì ìˆ˜ (1ì—ì„œ 5 ì‚¬ì´ì˜ ì •ìˆ˜)\",\n  \"requires_action\": \"ì‘ë‹µ ë˜ëŠ” í–‰ë™ í•„ìš” ì—¬ë¶€ (boolean: true ë˜ëŠ” false)\",\n  \"suggested_action\": \"ì‚¬ìš©ìë¥¼ ìœ„í•œ ì¶”ì²œ í–‰ë™ (ì˜ˆ: 'ì¦‰ì‹œ íšŒì‹  í•„ìš”', 'ì˜¤ëŠ˜ ì¤‘ìœ¼ë¡œ ê²€í† ', 'ì •ë³´ í™•ì¸ í›„ ë³´ê´€')\"\n}",
        "userPromptTemplate": "ë¶„ì„í•  ì´ë©”ì¼ ë°ì´í„°:\n\në°œì‹ ì: {{ $json.from }}\nì œëª©: {{ $json.subject }}\në³¸ë¬¸: {{ $json.body }}\n\nìœ„ ì´ë©”ì¼ì„ ë¶„ì„í•˜ì—¬ JSON í˜•ì‹ìœ¼ë¡œ ë¶„ë¥˜ ê²°ê³¼ë¥¼ ë°˜í™˜í•´ì£¼ì„¸ìš”."
      },
      "id": "ai-classifier",
      "name": "AI ì´ë©”ì¼ ë¶„ë¥˜ê¸°",
      "type": "n8n-nodes-langchain.chainLlm",
      "typeVersion": 1,
      "position": [680, 300],
      "credentials": {
        "openAiApi": {
          "id": "openai_credentials",
          "name": "OpenAI API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// AI ì‘ë‹µì„ JSONìœ¼ë¡œ íŒŒì‹±\ntry {\n  const aiResponse = $input.item(0).json.text || $input.item(0).json.response;\n  const classificationResult = JSON.parse(aiResponse);\n  \n  // ì›ë³¸ ì´ë©”ì¼ ë°ì´í„°ì™€ ë¶„ë¥˜ ê²°ê³¼ í•©ì¹˜ê¸°\n  const originalEmail = $node['ë°ì´í„° ì „ì²˜ë¦¬'].json;\n  \n  return [{\n    json: {\n      ...originalEmail,\n      ...classificationResult,\n      timestamp: new Date().toISOString(),\n      messageId: $node['Gmail Trigger'].json.id\n    }\n  }];\n} catch (error) {\n  // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’ ì„¤ì •\n  return [{\n    json: {\n      ...$node['ë°ì´í„° ì „ì²˜ë¦¬'].json,\n      category: 'unknown',\n      summary: 'AI ë¶„ë¥˜ ì‹¤íŒ¨',\n      urgency_score: 2,\n      requires_action: false,\n      suggested_action: 'ìˆ˜ë™ ê²€í†  í•„ìš”',\n      error: error.message,\n      timestamp: new Date().toISOString(),\n      messageId: $node['Gmail Trigger'].json.id\n    }\n  }];\n}"
      },
      "id": "result-parser",
      "name": "ê²°ê³¼ íŒŒì‹±",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 300]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "urgent-condition",
              "leftValue": "={{ $json.category }}",
              "rightValue": "urgent",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "important-condition", 
              "leftValue": "={{ $json.category }}",
              "rightValue": "important",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "promotional-condition",
              "leftValue": "={{ $json.category }}",
              "rightValue": "promotional", 
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "personal-condition",
              "leftValue": "={{ $json.category }}",
              "rightValue": "personal",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "notification-condition",
              "leftValue": "={{ $json.category }}",
              "rightValue": "notification",
              "operator": {
                "type": "string", 
                "operation": "equals"
              }
            },
            {
              "id": "spam-condition",
              "leftValue": "={{ $json.category }}",
              "rightValue": "spam",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "category-switch",
      "name": "ì¹´í…Œê³ ë¦¬ë³„ ë¶„ê¸°",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [1120, 300]
    },
    {
      "parameters": {
        "workflowId": "{{ $vars.URGENT_WORKFLOW_ID }}",
        "source": "parameter",
        "options": {}
      },
      "id": "urgent-workflow",
      "name": "ğŸš¨ ê¸´ê¸‰ ì²˜ë¦¬",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1,
      "position": [1340, 120]
    },
    {
      "parameters": {
        "workflowId": "{{ $vars.IMPORTANT_WORKFLOW_ID }}",
        "source": "parameter",
        "options": {}
      },
      "id": "important-workflow", 
      "name": "âš ï¸ ì¤‘ìš” ì²˜ë¦¬",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1,
      "position": [1340, 200]
    },
    {
      "parameters": {
        "workflowId": "{{ $vars.PROMOTIONAL_WORKFLOW_ID }}",
        "source": "parameter",
        "options": {}
      },
      "id": "promotional-workflow",
      "name": "ğŸ“¢ í”„ë¡œëª¨ì…˜ ì²˜ë¦¬", 
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1,
      "position": [1340, 280]
    },
    {
      "parameters": {
        "workflowId": "{{ $vars.PERSONAL_WORKFLOW_ID }}",
        "source": "parameter",
        "options": {}
      },
      "id": "personal-workflow",
      "name": "ğŸ‘¤ ê°œì¸ ì²˜ë¦¬",
      "type": "n8n-nodes-base.executeWorkflow", 
      "typeVersion": 1,
      "position": [1340, 360]
    },
    {
      "parameters": {
        "workflowId": "{{ $vars.NOTIFICATION_WORKFLOW_ID }}",
        "source": "parameter",
        "options": {}
      },
      "id": "notification-workflow",
      "name": "ğŸ”” ì•Œë¦¼ ì²˜ë¦¬",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1,
      "position": [1340, 440]
    },
    {
      "parameters": {
        "workflowId": "{{ $vars.SPAM_WORKFLOW_ID }}",
        "source": "parameter", 
        "options": {}
      },
      "id": "spam-workflow",
      "name": "ğŸ—‘ï¸ ìŠ¤íŒ¸ ì²˜ë¦¬",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1,
      "position": [1340, 520]
    }
  ],
  "connections": {
    "Gmail Trigger": {
      "main": [
        [
          {
            "node": "ë°ì´í„° ì „ì²˜ë¦¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë°ì´í„° ì „ì²˜ë¦¬": {
      "main": [
        [
          {
            "node": "AI ì´ë©”ì¼ ë¶„ë¥˜ê¸°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI ì´ë©”ì¼ ë¶„ë¥˜ê¸°": {
      "main": [
        [
          {
            "node": "ê²°ê³¼ íŒŒì‹±",
            "type": "main", 
            "index": 0
          }
        ]
      ]
    },
    "ê²°ê³¼ íŒŒì‹±": {
      "main": [
        [
          {
            "node": "ì¹´í…Œê³ ë¦¬ë³„ ë¶„ê¸°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì¹´í…Œê³ ë¦¬ë³„ ë¶„ê¸°": {
      "main": [
        [
          {
            "node": "ğŸš¨ ê¸´ê¸‰ ì²˜ë¦¬",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "âš ï¸ ì¤‘ìš” ì²˜ë¦¬",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“¢ í”„ë¡œëª¨ì…˜ ì²˜ë¦¬",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ‘¤ ê°œì¸ ì²˜ë¦¬",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ”” ì•Œë¦¼ ì²˜ë¦¬",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ—‘ï¸ ìŠ¤íŒ¸ ì²˜ë¦¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2024-12-19T10:00:00.000Z",
      "updatedAt": "2024-12-19T10:00:00.000Z", 
      "id": "email-automation",
      "name": "ì´ë©”ì¼ ìë™í™”"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2024-12-19T10:00:00.000Z",
  "versionId": "1"
} 