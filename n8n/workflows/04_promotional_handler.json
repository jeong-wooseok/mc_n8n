{
  "name": "ğŸ“¢ í”„ë¡œëª¨ì…˜ ì´ë©”ì¼ ì²˜ë¦¬ ì›Œí¬í”Œë¡œìš°",
  "nodes": [
    {
      "parameters": {},
      "id": "workflow-trigger",
      "name": "ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±°",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "jsCode": "// í”„ë¡œëª¨ì…˜ ì´ë©”ì¼ í‚¤ì›Œë“œ ë¶„ì„ ë° ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜\nconst data = $input.item(0).json;\n\n// ê´€ì‹¬ í‚¤ì›Œë“œ ëª©ë¡\nconst interestKeywords = {\n  discount: ['í• ì¸', 'ì„¸ì¼', 'sale', 'discount', 'íŠ¹ê°€', 'ì´ë²¤íŠ¸'],\n  tech: ['AI', 'ì¸ê³µì§€ëŠ¥', 'ê°œë°œ', 'programming', 'ì½”ë”©', 'í…Œí¬', 'SaaS'],\n  education: ['ê°•ì˜', 'êµìœ¡', 'ìˆ˜ì—…', 'course', 'learning', 'ì˜¨ë¼ì¸'],\n  shopping: ['ì‡¼í•‘', 'êµ¬ë§¤', 'ìƒí’ˆ', 'product', 'ë°°ì†¡', 'ë¬´ë£Œ'],\n  finance: ['íˆ¬ì', 'ê¸ˆìœµ', 'ì¹´ë“œ', 'ëŒ€ì¶œ', 'ë³´í—˜', 'ì ê¸ˆ']\n};\n\n// í‚¤ì›Œë“œ ë§¤ì¹­ í•¨ìˆ˜\nfunction findMatchingKeywords(text, keywords) {\n  const found = [];\n  const textLower = text.toLowerCase();\n  for (const [category, words] of Object.entries(keywords)) {\n    const matches = words.filter(word => textLower.includes(word.toLowerCase()));\n    if (matches.length > 0) {\n      found.push({ category, matches });\n    }\n  }\n  return found;\n}\n\nconst emailText = `${data.subject} ${data.body}`.toLowerCase();\nconst matchedKeywords = findMatchingKeywords(emailText, interestKeywords);\n\n// ê´€ì‹¬ë„ ì ìˆ˜ ê³„ì‚° (ë§¤ì¹­ëœ í‚¤ì›Œë“œ ìˆ˜ì— ë”°ë¼)\nconst interestScore = matchedKeywords.reduce((score, match) => score + match.matches.length, 0);\nconst isInteresting = interestScore >= 2; // 2ê°œ ì´ìƒ í‚¤ì›Œë“œ ë§¤ì¹­ì‹œ ê´€ì‹¬ ìˆìŒ\n\nconst promotionalData = {\n  email_info: {\n    from: data.from,\n    subject: data.subject,\n    summary: data.summary,\n    timestamp: data.timestamp,\n    messageId: data.messageId\n  },\n  analysis: {\n    matched_keywords: matchedKeywords,\n    interest_score: interestScore,\n    is_interesting: isInteresting,\n    categories: matchedKeywords.map(m => m.category)\n  },\n  sheets_data: {\n    values: [[\n      new Date().toISOString().split('T')[0], // ë‚ ì§œ\n      data.from,                              // ë°œì‹ ì\n      data.subject,                           // ì œëª©\n      matchedKeywords.map(m => m.category).join(', '), // ì¹´í…Œê³ ë¦¬\n      interestScore,                          // ê´€ì‹¬ë„\n      isInteresting ? 'ê´€ì‹¬ìˆìŒ' : 'ì¼ë°˜',      // ë¶„ë¥˜\n      matchedKeywords.map(m => m.matches.join(', ')).join(' | ') // ë§¤ì¹­ í‚¤ì›Œë“œ\n    ]]\n  }\n};\n\nreturn [{ json: promotionalData }];"
      },
      "id": "keyword-analyzer",
      "name": "í‚¤ì›Œë“œ ë¶„ì„",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 300]
    },
    {
      "parameters": {
        "operation": "archive",
        "messageId": "={{ $json.email_info.messageId }}"
      },
      "id": "gmail-archive",
      "name": "Gmail ì•„ì¹´ì´ë¸Œ",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2,
      "position": [680, 200],
      "credentials": {
        "gmailOAuth2": {
          "id": "gmail_credentials",
          "name": "Gmail OAuth2"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "{{ $vars.PROMOTIONAL_SPREADSHEET_ID }}",
          "mode": "list"
        },
        "sheetName": "í”„ë¡œëª¨ì…˜ ë¡œê·¸",
        "columnToMatchOn": "A",
        "valueToMatchOn": "={{ $json.email_info.timestamp }}",
        "options": {
          "continue": true,
          "valueInputMode": "USER_ENTERED"\n        },\n        "dataStartRow": 2,\n        "keyRowHeaders": [\n          \"ë‚ ì§œ\",\n          \"ë°œì‹ ì\", \n          \"ì œëª©\",\n          \"ì¹´í…Œê³ ë¦¬\",\n          \"ê´€ì‹¬ë„\",\n          \"ë¶„ë¥˜\",\n          \"í‚¤ì›Œë“œ\"\n        ],\n        \"values\": \"={{ $json.sheets_data.values }}\"\n      },\n      \"id\": \"sheets-logging\",\n      \"name\": \"ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë¡œê¹…\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"typeVersion\": 4,\n      \"position\": [680, 300],\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"google_sheets_credentials\",\n          \"name\": \"Google Sheets OAuth2\"\n        }\n      }\n    },\n    {\n      \"parameters\": {\n        \"conditions\": {\n          \"options\": {\n            \"caseSensitive\": true,\n            \"leftValue\": \"\",\n            \"typeValidation\": \"strict\"\n          },\n          \"conditions\": [\n            {\n              \"id\": \"interesting-promo\",\n              \"leftValue\": \"={{ $json.analysis.is_interesting }}\",\n              \"rightValue\": true,\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\"\n              }\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"id\": \"interest-check\",\n      \"name\": \"ê´€ì‹¬ë„ ì²´í¬\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"typeVersion\": 2,\n      \"position\": [900, 300]\n    },\n    {\n      \"parameters\": {\n        \"operation\": \"addLabels\",\n        \"messageId\": \"={{ $json.email_info.messageId }}\",\n        \"labelIds\": [\"Label_3456789012\"]\n      },\n      \"id\": \"gmail-interesting-label\",\n      \"name\": \"Gmail ê´€ì‹¬ ë¼ë²¨\",\n      \"type\": \"n8n-nodes-base.gmail\",\n      \"typeVersion\": 2,\n      \"position\": [1120, 200],\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"gmail_credentials\",\n          \"name\": \"Gmail OAuth2\"\n        }\n      }\n    },\n    {\n      \"parameters\": {\n        \"authentication\": \"oAuth2\",\n        \"select\": \"user\",\n        \"user\": {\n          \"__rl\": true,\n          \"value\": \"U3456789012\",\n          \"mode\": \"list\",
          \"cachedResultName\": \"ê°œì¸DM\"\n        },\n        \"text\": \"ğŸ“¢ *ê´€ì‹¬ìˆëŠ” í”„ë¡œëª¨ì…˜ ì´ë©”ì¼ ë°œê²¬!*\\n\\n*ë°œì‹ ì:* {{ $json.email_info.from }}\\n*ì œëª©:* {{ $json.email_info.subject }}\\n*ì¹´í…Œê³ ë¦¬:* {{ $json.analysis.categories.join(', ') }}\\n*ë§¤ì¹­ í‚¤ì›Œë“œ:* {{ $json.analysis.matched_keywords.map(m => m.matches.join(', ')).join(' | ') }}\\n\\n<https://mail.google.com/mail/u/0/#inbox/{{ $json.email_info.messageId }}|ì´ë©”ì¼ í™•ì¸í•˜ê¸°>\"\n      },\n      \"id\": \"slack-interesting-alert\",\n      \"name\": \"ê°œì¸ ê´€ì‹¬ ì•Œë¦¼\",\n      \"type\": \"n8n-nodes-base.slack\",\n      \"typeVersion\": 2.1,\n      \"position\": [1120, 300],\n      \"credentials\": {\n        \"slackOAuth2Api\": {\n          \"id\": \"slack_credentials\",\n          \"name\": \"Slack OAuth2\"\n        }\n      }\n    },\n    {\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {\n              \"field\": \"cronExpression\",\n              \"expression\": \"0 17 * * 5\"\n            }\n          ]\n        }\n      },\n      \"id\": \"weekly-schedule\",\n      \"name\": \"ì£¼ê°„ ìŠ¤ì¼€ì¤„ (ê¸ˆìš”ì¼ 5PM)\",\n      \"type\": \"n8n-nodes-base.cron\",\n      \"typeVersion\": 1,\n      \"position\": [240, 600]\n    },\n    {\n      \"parameters\": {\n        \"operation\": \"readRows\",\n        \"documentId\": {\n          \"__rl\": true,\n          \"value\": \"{{ $vars.PROMOTIONAL_SPREADSHEET_ID }}\",\n          \"mode\": \"list\"\n        },\n        \"sheetName\": \"í”„ë¡œëª¨ì…˜ ë¡œê·¸\",\n        \"options\": {\n          \"range\": \"A2:G1000\"\n        }\n      },\n      \"id\": \"weekly-data-fetch\",\n      \"name\": \"ì£¼ê°„ ë°ì´í„° ì¡°íšŒ\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"typeVersion\": 4,\n      \"position\": [460, 600],\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"google_sheets_credentials\",\n          \"name\": \"Google Sheets OAuth2\"\n        }\n      }\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"// ì£¼ê°„ í”„ë¡œëª¨ì…˜ ì´ë©”ì¼ ìš”ì•½ ìƒì„±\\nconst data = $input.all();\\n\\n// ì§€ë‚œ 7ì¼ê°„ì˜ ë°ì´í„° í•„í„°ë§\\nconst oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\\nconst weeklyData = data.filter(item => {\\n  const emailDate = new Date(item.json[0]); // ì²« ë²ˆì§¸ ì»¬ëŸ¼ì´ ë‚ ì§œ\\n  return emailDate >= oneWeekAgo;\\n});\\n\\n// í†µê³„ ê³„ì‚°\\nconst totalEmails = weeklyData.length;\\nconst interestingEmails = weeklyData.filter(item => item.json[5] === 'ê´€ì‹¬ìˆìŒ').length;\\n\\n// ì¹´í…Œê³ ë¦¬ë³„ ì§‘ê³„\\nconst categoryStats = {};\\nweeklyData.forEach(item => {\\n  const categories = item.json[3].split(', ').filter(c => c);\\n  categories.forEach(cat => {\\n    categoryStats[cat] = (categoryStats[cat] || 0) + 1;\\n  });\\n});\\n\\n// ë°œì‹ ìë³„ ì§‘ê³„ (ìƒìœ„ 5ê°œ)\\nconst senderStats = {};\\nweeklyData.forEach(item => {\\n  const sender = item.json[1];\\n  senderStats[sender] = (senderStats[sender] || 0) + 1;\\n});\\nconst topSenders = Object.entries(senderStats)\\n  .sort(([,a], [,b]) => b - a)\\n  .slice(0, 5);\\n\\n// Slack ë©”ì‹œì§€ ìƒì„±\\nconst summaryMessage = {\\n  text: \\\"ğŸ“ˆ *ì£¼ê°„ í”„ë¡œëª¨ì…˜ ì´ë©”ì¼ ìš”ì•½*\\\",\\n  blocks: [\\n    {\\n      \\\"type\\\": \\\"header\\\",\\n      \\\"text\\\": {\\n        \\\"type\\\": \\\"plain_text\\\",\\n        \\\"text\\\": \\\"ğŸ“ˆ ì£¼ê°„ í”„ë¡œëª¨ì…˜ ì´ë©”ì¼ ìš”ì•½ (ì§€ë‚œ 7ì¼)\\\"\\n      }\\n    },\\n    {\\n      \\\"type\\\": \\\"section\\\",\\n      \\\"fields\\\": [\\n        {\\n          \\\"type\\\": \\\"mrkdwn\\\",\\n          \\\"text\\\": `*ì´ ì´ë©”ì¼:*\\\\n${totalEmails}ê°œ`\\n        },\\n        {\\n          \\\"type\\\": \\\"mrkdwn\\\",\\n          \\\"text\\\": `*ê´€ì‹¬ ì´ë©”ì¼:*\\\\n${interestingEmails}ê°œ`\\n        }\\n      ]\\n    },\\n    {\\n      \\\"type\\\": \\\"section\\\",\\n      \\\"text\\\": {\\n        \\\"type\\\": \\\"mrkdwn\\\",\\n        \\\"text\\\": `*ì¹´í…Œê³ ë¦¬ë³„ í†µê³„:*\\\\n${Object.entries(categoryStats).map(([cat, count]) => `â€¢ ${cat}: ${count}ê°œ`).join('\\\\n')}`\\n      }\\n    },\\n    {\\n      \\\"type\\\": \\\"section\\\",\\n      \\\"text\\\": {\\n        \\\"type\\\": \\\"mrkdwn\\\",\\n        \\\"text\\\": `*ì£¼ìš” ë°œì‹ ì (Top 5):*\\\\n${topSenders.map(([sender, count], idx) => `${idx + 1}. ${sender}: ${count}ê°œ`).join('\\\\n')}`\\n      }\\n    },\\n    {\\n      \\\"type\\\": \\\"actions\\\",\\n      \\\"elements\\\": [\\n        {\\n          \\\"type\\\": \\\"button\\\",\\n          \\\"text\\\": {\\n            \\\"type\\\": \\\"plain_text\\\",\\n            \\\"text\\\": \\\"ìƒì„¸ ë¡œê·¸ ë³´ê¸°\\\"\\n          },\\n          \\\"url\\\": `https://docs.google.com/spreadsheets/d/{{ $vars.PROMOTIONAL_SPREADSHEET_ID }}`,\\n          \\\"style\\\": \\\"primary\\\"\\n        }\\n      ]\\n    }\\n  ]\\n};\\n\\nreturn [{ json: summaryMessage }];\"\n      },\n      \"id\": \"weekly-summary\",\n      \"name\": \"ì£¼ê°„ ìš”ì•½ ìƒì„±\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [680, 600]\n    },\n    {\n      \"parameters\": {\n        \"authentication\": \"oAuth2\",\n        \"select\": \"channel\",\n        \"channelId\": {\n          \"__rl\": true,\n          \"value\": \"C4567890123\",\n          \"mode\": \"list\",\n          \"cachedResultName\": \"#weekly-summary\"\n        },\n        \"text\": \"={{ $json.text }}\",\n        \"blocksUi\": {\n          \"blocksValues\": [\n            {\n              \"block\": \"={{ JSON.stringify($json.blocks) }}\"\n            }\n          ]\n        },\n        \"otherOptions\": {\n          \"mrkdwn\": true\n        }\n      },\n      \"id\": \"slack-weekly-summary\",\n      \"name\": \"ì£¼ê°„ ìš”ì•½ ë°œì†¡\",\n      \"type\": \"n8n-nodes-base.slack\",\n      \"typeVersion\": 2.1,\n      \"position\": [900, 600],\n      \"credentials\": {\n        \"slackOAuth2Api\": {\n          \"id\": \"slack_credentials\",\n          \"name\": \"Slack OAuth2\"\n        }\n      }\n    }\n  ],\n  \"connections\": {\n    \"ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±°\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"í‚¤ì›Œë“œ ë¶„ì„\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"í‚¤ì›Œë“œ ë¶„ì„\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Gmail ì•„ì¹´ì´ë¸Œ\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë¡œê¹…\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë¡œê¹…\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ê´€ì‹¬ë„ ì²´í¬\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ê´€ì‹¬ë„ ì²´í¬\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Gmail ê´€ì‹¬ ë¼ë²¨\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"ê°œì¸ ê´€ì‹¬ ì•Œë¦¼\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ì£¼ê°„ ìŠ¤ì¼€ì¤„ (ê¸ˆìš”ì¼ 5PM)\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ì£¼ê°„ ë°ì´í„° ì¡°íšŒ\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ì£¼ê°„ ë°ì´í„° ì¡°íšŒ\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ì£¼ê°„ ìš”ì•½ ìƒì„±\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ì£¼ê°„ ìš”ì•½ ìƒì„±\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ì£¼ê°„ ìš”ì•½ ë°œì†¡\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  },\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"staticData\": null,\n  \"tags\": [\n    {\n      \"createdAt\": \"2024-12-19T10:00:00.000Z\",\n      \"updatedAt\": \"2024-12-19T10:00:00.000Z\",\n      \"id\": \"email-automation\",\n      \"name\": \"ì´ë©”ì¼ ìë™í™”\"\n    }\n  ],\n  \"triggerCount\": 1,\n  \"updatedAt\": \"2024-12-19T10:00:00.000Z\",\n  \"versionId\": \"1\"\n} 